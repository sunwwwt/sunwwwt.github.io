---
layout:     post
title:      音视频基础知识
subtitle:   音频和视频基础概念普及
date:       2020-01-29
author:     Sunw
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - video
    - audio
---

### 声音三要素
- 音调：就是音频，男生->女生->儿童
```
相同时间内，声波个数越多，频率高，音调高
```
- 音量：振动的幅度
```
震动幅度越大，音量越大
```
- 音色：它与材质有很大的关系，本质是谐波
```
基波，谐波
基波，畸变波形(会产生噪音)，谐波
```
### 人类听觉范围
声音压缩时，把次声波和超声波数据过滤掉，可以减少数据量

```
次声波   |  可听声波  | 超声波 
       20Hz        20KHz        
```

---

### 音频量化过程
- 采样大小：一个采用用多少bit存放。常用的是16bit
- 采样率：采样频率 8K、16k、32k、44.1k、48k    aac采用的44.1 
- 声道数：单声道、双声道、多声道

### 码率计算
```
码率 = 采样率 * 采样大小 * 声道数
eg:
采样率为44.1KHz
采样大小为16bit
双声道的PCM编码的WAV文件
它的码率为44.1K x 16 x 2 = 1411.2Kb/s        KB = Kb/8         
```
### 音频压缩技术
- 消除冗余数据
- 哈夫曼无损编码

### 音频编解码器选择
```
OPUS:
AAC:应用于泛娱乐化直播中，实时性要求不高，但是对音质有要求，直播一般用RTMP协议,RTMP协议支持AAC和Speex,不支持OPUS
Vorbis：
Speex:包含回音消除，降噪模块
iLBC：
AMR：
G.711,G.722：固话一般使用，如果视频会议和固话对接，需要支持g711,g722

性能对比：   OPUS > AAC > Vorbis
实时互动：opus
泛娱乐化：aac
如果泛娱乐化直播和实时互动系统结合：需要opus和acc互转
如果实时互动和固话结合，需要opus和g711,g722互转
```
---
### AAC介绍
- 应用范围广，直播系统90%支持，RTMP支持AAC
- AAC目的是取代MP3
- AAC规格描述
```
AAC LC:(Low Complexity)低复杂度，码流128k
AAC HE:AAC LC + SBR(Spectral Band Replication)
  SBR分频复用，低频减少采样 高频增加采样；减小了码率，增加了高频的音质
AAC HE V2:AAC LC + SBR + PS(PArametric Stereo)
  PS 音频两个声道关联性非常强，另一个声道只要存放一些参数，播放的时候根据参数和一个声道去恢复数据
```
- AAC格式
```
ADIF(Audio Data INterchange Format)
在文件头有音频参数信息
这种格式只能从头开始解码，常用在磁盘文件中

ADTS(Audio Data Transport Stream)
每一帧都有音频参数信息
这种格式每一帧都有一个同步字，可以在音频流的任何位置开始解码，它类似于数据流格式
```
- AAC编码库选择
```
Libfdk_AAC > ffmpeg AAC > libfaac > libvo_aacenc
```

---
### H264基本概念
- I帧：关键帧，采用帧内压缩技术
- P帧：向前参考帧，压缩时只参考前一个帧，属于帧间压缩技术
- B帧：双向参考帧，压缩时及参考前一帧也参考后一帧，帧间压缩技术
```
实时互动不用B帧，泛娱乐化直播可以用B帧
```
#### GOF
两个I帧之间一组帧称为一个GOF
#### SPS PPS
Sequence Parameter Set,序列参数集，存放帧数、参考帧数目、解码图像尺寸、帧场编码模式选择标识等
Picture Parameter Set,图像参数集，存放熵编码模式选择标识、片组数目、初始量化参数和去方块滤波系数调整标识等
#### 视频花屏/卡顿原因
- 如果GOP分组中的P帧丢失会造成解码端的图像发生错误
- 为了避免花瓶问题的发生，一般如果发现P帧或者I帧丢失，就不显示本GOP内的所有帧，直到下一个I帧来后重新刷新图像

#### 视频编码器
- x264/x265
   x265在直播中不可用，严重占用cpu,在点播中可以尝试用，压缩比高
- openH264
  相对于x264性能低一点，但是支持SVC技术（将视频分层传输，网络好全部发送，网络不好发送内核层，对端解码后，相对模糊，每多发一层，视频更清楚；移动端svc不是标准，只支持软编，无法使用硬件）
- vp8/vp9

#### H264压缩技术
- 帧内压测压缩，解决的是空域数据冗余问题
- 帧间预测压缩，解决的是时域数据冗余问题
- 整数离散余弦变换（DCT）,将空间上的相关性变为频域上无关的数据然后进行量化
- CABAC压缩

##### 宏块划分 子块划分 帧分组
##### 组内宏块查找
